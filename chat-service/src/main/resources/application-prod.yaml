spring:
  application:
    name: blinx-chat-service

  # Lazy-init beans to reduce startup memory and time
  main:
    lazy-initialization: false

  data:
    mongodb:
      uri: ${SPRING_DATA_MONGODB_URI:${MONGODB_URI}}
      # Prevent startup crashes when existing prod data violates new unique indexes.
      # We repair/ensure indexes after startup in code.
      auto-index-creation: false
    redis:
      host: ${SPRING_DATA_REDIS_HOST}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      password: ${SPRING_DATA_REDIS_PASSWORD}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: ${REDIS_POOL_MAX_ACTIVE:8}
          max-idle: ${REDIS_POOL_MAX_IDLE:4}
          min-idle: ${REDIS_POOL_MIN_IDLE:1}
          max-wait: ${REDIS_POOL_MAX_WAIT:2000ms}
        shutdown-timeout: 200ms

  mail:
    brevo:
      api-key: ${BREVO_API_KEY}
      api-url: ${BREVO_API_URL:https://api.brevo.com/v3/smtp/email}
    sender:
      email: ${BREVO_SENDER_EMAIL}
      name: ${BREVO_SENDER_NAME:BlinxAI}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: never

# Disable Swagger in production to save ~30MB of memory
springdoc:
  api-docs:
    enabled: ${SPRINGDOC_ENABLED:false}
  swagger-ui:
    enabled: ${SPRINGDOC_ENABLED:false}

server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /
  # Tomcat tuned for low-memory environments
  tomcat:
    threads:
      max: ${SERVER_TOMCAT_MAX_THREADS:50}
      min-spare: ${SERVER_TOMCAT_MIN_SPARE_THREADS:5}
    connection-timeout: 10000ms
    max-connections: 200
    accept-count: 50
    keep-alive-timeout: 30000ms
  # Enable response compression to reduce bandwidth and latency
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/plain,text/css,application/javascript
    min-response-size: 1024

jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}          # 24 hours
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:2592000000}  # 30 days

app:
  otp:
    length: ${APP_OTP_LENGTH:6}
    expiration: ${APP_OTP_EXPIRATION:300000}
  phone-prefix: ${APP_PHONE_PREFIX:+91}
  sms:
    enabled: ${APP_SMS_ENABLED:true}
    provider: ${APP_SMS_PROVIDER:twilio}
    twilio:
      account-sid: ${TWILIO_ACCOUNT_SID}
      auth-token: ${TWILIO_AUTH_TOKEN}
      from-number: ${TWILIO_FROM_NUMBER}

  oauth2:
    google:
      client-id: ${GOOGLE_CLIENT_ID}
      client-secret: ${GOOGLE_CLIENT_SECRET}
      redirect-uri: ${GOOGLE_REDIRECT_URI}
      encryption-password: ${GOOGLE_OAUTH_ENCRYPTION_PASSWORD}
      encryption-salt: ${GOOGLE_OAUTH_ENCRYPTION_SALT}
      default-redirect-uri: ${GOOGLE_OAUTH_DEFAULT_REDIRECT_URI}
      error-redirect-uri: ${GOOGLE_OAUTH_ERROR_REDIRECT_URI}
      scopes:
        - email
        - profile
        - https://www.googleapis.com/auth/calendar
        - https://www.googleapis.com/auth/gmail.modify
        - https://www.googleapis.com/auth/gmail.send
      allowed-frontend-origins:
        - https://blinx-app.netlify.app
        - https://blinxAI.me
        - https://www.blinxAI.me

  cors:
    allowed-origins: ${APP_CORS_ALLOWED_ORIGINS:https://blinxai.me,https://www.blinxai.me,https://blinx-app.netlify.app,http://localhost:8080,http://localhost:5173,http://localhost:5174,http://localhost:4173}
  frontend-url: ${APP_FRONTEND_URL:https://blinxai.me}

api:
  server:
    # Here I have to use service DNS or public URL instead of localhost
    url: ${API_SERVER_URL:http://localhost:8080}

ai:
  provider: ${AI_PROVIDER:openai}
  api-key: ${AI_API_KEY:}
  base-url: ${AI_BASE_URL:https://api.openai.com}
  model: ${AI_MODEL:gpt-4o-mini}

web:
  search:
    api-key: ${WEB_SEARCH_API_KEY:}
    cache:
      ttl:
        seconds: ${WEB_SEARCH_CACHE_TTL_SECONDS:300}
    timeout:
      seconds: ${WEB_SEARCH_TIMEOUT_SECONDS:10}

logging:
  level:
    root: WARN
    com.blink.chatservice: INFO
    org.springframework.web: WARN
    org.mongodb.driver: WARN