spring:
  application:
    name: blinx-chat-service

  data:
    mongodb:
      # Connection pool tuned via URI parameters
      uri: ${SPRING_DATA_MONGODB_URI:mongodb://mongo:27017/blink_chat?minPoolSize=5&maxPoolSize=50}
      auto-index-creation: true
    redis:
      host: ${SPRING_DATA_REDIS_HOST:redis}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      password: ${SPRING_DATA_REDIS_PASSWORD:}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: ${SPRING_DATA_REDIS_POOL_MAX_ACTIVE:8}
          max-idle: ${SPRING_DATA_REDIS_POOL_MAX_IDLE:4}
          min-idle: ${SPRING_DATA_REDIS_POOL_MIN_IDLE:0}
          max-wait: ${SPRING_DATA_REDIS_POOL_MAX_WAIT:2000ms}
        shutdown-timeout: 200ms

  mail:
    brevo:
      api-key: ${BREVO_API_KEY}
      api-url: ${BREVO_API_URL:https://api.brevo.com/v3/smtp/email}
    sender:
      email: ${BREVO_SENDER_EMAIL}
      name: ${BREVO_SENDER_NAME:BlinxAI}

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html

server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /
  # Tomcat embedded server tuning
  tomcat:
    threads:
      max: ${SERVER_TOMCAT_MAX_THREADS:100}
      min-spare: ${SERVER_TOMCAT_MIN_SPARE_THREADS:5}
    connection-timeout: ${SERVER_TOMCAT_CONNECTION_TIMEOUT:10000ms}
    max-connections: 400
    accept-count: 100
    keep-alive-timeout: 30000ms
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/plain,text/css,application/javascript
    min-response-size: 1024

jwt:
  secret: ${JWT_SECRET:2e804WBYw6Ke/fBUrvcmS9CHUeZK9uLzUw1A4qbh8vY=}
  expiration: ${JWT_EXPIRATION:86400000}          # 24 hours
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:2592000000}  # 30 days

app:
  otp:
    length: ${APP_OTP_LENGTH:6}
    expiration: ${APP_OTP_EXPIRATION:300000}
  phone-prefix: ${APP_PHONE_PREFIX:+91}
  sms:
    enabled: ${APP_SMS_ENABLED:true}
    provider: ${APP_SMS_PROVIDER:twilio}
    twilio:
      account-sid: ${TWILIO_ACCOUNT_SID:}
      auth-token: ${TWILIO_AUTH_TOKEN:}
      from-number: ${TWILIO_FROM_NUMBER:+12052674639}

  oauth2:
    google:
      client-id: ${GOOGLE_CLIENT_ID:}
      client-secret: ${GOOGLE_CLIENT_SECRET:}
      redirect-uri: ${GOOGLE_REDIRECT_URI:https://api.blinxai.me/api/v1/auth/google/callback}
      encryption-password: ${GOOGLE_OAUTH_ENCRYPTION_PASSWORD:}
      encryption-salt: ${GOOGLE_OAUTH_ENCRYPTION_SALT:}
      default-redirect-uri: ${GOOGLE_OAUTH_DEFAULT_REDIRECT_URI:https://blinxai.me/chat}
      error-redirect-uri: ${GOOGLE_OAUTH_ERROR_REDIRECT_URI:https://blinxai.me/auth?error=true}
      scopes:
        - email
        - profile
        - https://www.googleapis.com/auth/calendar.events
        - https://www.googleapis.com/auth/gmail.readonly
        - https://www.googleapis.com/auth/gmail.send
      allowed-frontend-origins:
        - https://blinx-app.netlify.app
        - https://blinxai.me
        - https://www.blinxai.me

  cors:
    allowed-origins: ${APP_CORS_ALLOWED_ORIGINS:https://blinxai.me,https://www.blinxai.me,https://blinx-app.netlify.app,http://k8s-blinkcha-blinkcha-15ee8fd614-2137738643.ap-south-1.elb.amazonaws.com,http://localhost:8080,http://localhost:5173,http://localhost:5174}
  frontend-url: ${APP_FRONTEND_URL:https://blinxai.me}
  cookie:
    domain: ${APP_COOKIE_DOMAIN}

  # ── Rate Limiting (Redis-backed sliding window) ──
  rate-limit:
    enabled: ${RATE_LIMIT_ENABLED:true}
    global:
      max-requests: ${RATE_LIMIT_GLOBAL_MAX:120}
      window-seconds: ${RATE_LIMIT_GLOBAL_WINDOW:60}
    auth:
      max-requests: ${RATE_LIMIT_AUTH_MAX:5}
      window-seconds: ${RATE_LIMIT_AUTH_WINDOW:60}
    ai:
      max-requests: ${RATE_LIMIT_AI_MAX:20}
      window-seconds: ${RATE_LIMIT_AI_WINDOW:60}
    search:
      max-requests: ${RATE_LIMIT_SEARCH_MAX:20}
      window-seconds: ${RATE_LIMIT_SEARCH_WINDOW:60}
    calls:
      max-requests: ${RATE_LIMIT_CALLS_MAX:30}
      window-seconds: ${RATE_LIMIT_CALLS_WINDOW:60}
    email:
      max-requests: ${RATE_LIMIT_EMAIL_MAX:3}
      window-seconds: ${RATE_LIMIT_EMAIL_WINDOW:60}
    message-send:
      max-requests: ${RATE_LIMIT_MSG_SEND_MAX:30}
      window-seconds: ${RATE_LIMIT_MSG_SEND_WINDOW:60}

api:
  server:
    # Here I have to use service DNS or public URL instead of localhost
    url: ${API_SERVER_URL:http://chat-service:8080}

ai:
  provider: ${AI_PROVIDER:openai}
  api-key: ${AI_API_KEY:}
  base-url: ${AI_BASE_URL:https://api.openai.com}
  model: ${AI_MODEL:gpt-4o-mini}

  mcp:
    client:
      enabled: ${MCP_CLIENT_ENABLED:true}
      servers:
        name: chat-service-mcp-server
        type: SYNC
        example-server:
          transport: stdio
          command: node
          args:
            - ./mcp-server/index.js
          env:
            NODE_ENV: production

web:
  search:
    api-key: ${WEB_SEARCH_API_KEY:}
    cache:
      ttl:
        seconds: ${WEB_SEARCH_CACHE_TTL_SECONDS:300}
    timeout:
      seconds: ${WEB_SEARCH_TIMEOUT_SECONDS:10}

logging:
  file:
    name: ${LOG_FILE_PATH:./logs/chat-service-mcp.log}
  level:
    root: INFO
    com.blink.chatservice: INFO
    org.springframework.web.socket.config: WARN
    org.springframework.web.socket.messaging: WARN
    org.springframework.messaging.simp.broker: WARN
    org.apache.catalina.core: WARN
    io.lettuce.core: WARN
    org.mongodb.driver: WARN
